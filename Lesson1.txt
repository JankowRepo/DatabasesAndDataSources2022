create table JOBS (
    job_id number(20,2) GENERATED BY DEFAULT ON NULL AS IDENTITY,
    job_title varchar2(40),
    min_salary number(20,2),
    max_salary number(20,2),
    primary key(job_id)
);
    
create table job_history (
    employee_id number GENERATED by default on null as IDENTITY,
    start_date date,
    end_date date,
    job_id number(20,2),
    department_id number(20,2),
    primary key(employee_id, start_date)
);

create table employees (
    employee_id number GENERATED by default on null as IDENTITY,
    first_name varchar2(40),
    last_name varchar2(40),
    email varchar2(40),
    phone_number varchar2(40),
    hire_date date,
    job_id number,
    salary number,
    commision_pct number(3,2),
    manager_id number,
    department_id number(20,2),
    primary key(employee_id)
);

create table departments (
    department_id number GENERATED by default on null as IDENTITY,
    department_name varchar2(40),
    manager_id number,
    location_id number,
    primary key(department_id)
);

create table locations (
    location_id number GENERATED by default on null as IDENTITY,
    postal_code number,
    city varchar(40),
    state_province varchar(40),
    country_id number,
    primary key(location_id)
);

create table countries (
    country_id number GENERATED by default on null as IDENTITY,
    country_name VARCHAR2(40),
    region_id number,
    primary key(country_id)
);


create table regions (
    region_id number(20,2) GENERATED by default on null as IDENTITY,
    region_name VARCHAR2(40),
    primary key(region_id)
);

alter table job_history
add foreign key (department_id) references departments(department_id);

alter table countries
add foreign key (region_id) references regions(region_id);

alter table jobs add check (min_salary<max_salary+2000);

drop table job_history;

flashback table job_history to before drop;